<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üìã Tableau des Commandes</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: #f4f6f9; padding: 20px; }
    .container { max-width: 1200px; margin: auto; background: white; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); overflow: hidden; }
    header { background: #128C7E; color: white; padding: 30px; text-align: center; }
    header h1 { font-size: 28px; font-weight: 600; }
    .actions { display: flex; gap: 10px; margin: 20px 30px; flex-wrap: wrap; }
    .btn { padding: 12px 16px; border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; }
    .btn-refresh { background: #6c757d; color: white; }
    .btn-export { background: #28a745; color: white; }
    .btn-password { background: #fd7e14; color: white; }
    table { width: 100%; border-collapse: collapse; margin: 20px 30px; }
    th, td { padding: 14px 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f1f1f1; color: #333; font-weight: 600; }
    tr:hover { background: #f9f9f9; }
    .action-btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px; }
    .whatsapp { background: #25D366; color: white; }
    .delete { background: #dc3545; color: white; margin-left: 5px; }
    .no-orders { text-align: center; color: #888; padding: 60px 20px; font-style: italic; font-size: 18px; }
    .footer { text-align: center; padding: 20px; color: #888; font-size: 14px; background: #f8f9fa; border-top: 1px solid #eee; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìã Tableau des Commandes Re√ßues</h1>
    </header>
    <div class="actions">
      <button class="btn btn-refresh" onclick="renderOrders()">
        üîÑ Actualiser
      </button>
      <button class="btn btn-export" onclick="exportToCSV()">
        üì• Exporter en Excel
      </button>
      <button class="btn btn-password" onclick="logout()">
        üîê D√©connexion
      </button>
    </div>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Date</th>
          <th>Client</th>
          <th>Produit</th>
          <th>Quantit√©</th>
          <th>T√©l√©phone</th>
          <th>Wilaya</th>
          <th>Adresse</th>
          <th>Paiement</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="ordersList"></tbody>
    </table>
    <div id="noOrders" class="no-orders">
      Aucune commande n'a √©t√© re√ßue.
    </div>
    <div class="footer">
      &copy; 2025 - Syst√®me de gestion des commandes. Tous droits r√©serv√©s.
    </div>
  </div>
  <script>
    if (localStorage.getItem("authenticated") !== "true") {
      window.location.href = "password.html";
    }
    const ordersList = document.getElementById("ordersList");
    const noOrders = document.getElementById("noOrders");
    function renderOrders() {
      ordersList.innerHTML = "";
      const orders = JSON.parse(localStorage.getItem("orders")) || [];
      if (orders.length === 0) {
        noOrders.style.display = "block";
      } else {
        noOrders.style.display = "none";
        orders.forEach((order, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td><strong>${order.id}</strong></td>
            <td>${order.date}</td>
            <td>${order.customer}</td>
            <td>${order.product}</td>
            <td>${order.quantity}</td>
            <td>${order.phone}</td>
            <td>${order.wilaya}</td>
            <td>${order.address}</td>
            <td>${order.payment === 'cash' ? 'Paiement √† domicile' : order.payment === 'card' ? 'Carte bancaire' : 'EDahabia'}</td>
            <td>
              <button class="action-btn whatsapp" onclick="sendWhatsApp('${order.phone}')">
                üí¨ WhatsApp
              </button>
              <button class="action-btn delete" onclick="deleteOrder(${index})">
                ‚ùå Supprimer
              </button>
            </td>
          `;
          ordersList.appendChild(tr);
        });
      }
    }
    function sendWhatsApp(phone) {
      const cleanPhone = phone.replace(/[^0-9]/g, '');
      const url = `https://wa.me/213${cleanPhone}`;
      window.open(url, '_blank');
    }
    function deleteOrder(index) {
      if (confirm("Voulez-vous vraiment supprimer cette commande ?")) {
        let orders = JSON.parse(localStorage.getItem("orders")) || [];
        orders.splice(index, 1);
        localStorage.setItem("orders", JSON.stringify(orders));
        renderOrders();
      }
    }
    function exportToCSV() {
      const orders = JSON.parse(localStorage.getItem("orders")) || [];
      if (orders.length === 0) {
        alert("‚ùå Aucune commande √† exporter.");
        return;
      }
      const headers = ["ID", "Date", "Client", "Produit", "Quantit√©", "T√©l√©phone", "Wilaya", "Adresse", "Paiement"];
      const csv = [
        headers.join(";"),
        ...orders.map(o => [
          o.id,
          o.date,
          o.customer,
          o.product,
          o.quantity,
          o.phone,
          o.wilaya,
          o.address,
          o.payment === 'cash' ? 'Paiement √† domicile' : o.payment === 'card' ? 'Carte bancaire' : 'EDahabia'
        ].join(";"))
      ].join("\n");
      const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `export-commandes-${new Date().toISOString().slice(0,10)}.csv`;
      link.click();
    }
    function logout() {
      if (confirm("Voulez-vous vous d√©connecter ?")) {
        localStorage.removeItem("authenticated");
        window.location.href = "password.html";
      }
    }
    renderOrders();
  </script>
</body>
</html>